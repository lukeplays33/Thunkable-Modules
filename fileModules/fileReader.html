<html lang="en">

<head>
    <meta charset="UTF-8">
    <title>CodePen - A Pen by lukeplays33</title>
    <link rel="canonical" href="https://codepen.io/lukeplays33/pen/JjQOmMb">
</head>
<style>
    body,
    html {
        margin: 0px;

        width: 100%;
        height: 100%;

        background-color: TRANSPARENT;
    }
</style>

<body>
    <script src="https://thunkable.github.io/webviewer-extension/thunkableWebviewerExtension.js"
        type="text/javascript"></script>

    <script id="rendered-js">

        async function uploadImage(file) {
            const apiKey = "dce5cc1003ee33398de073ac1257b561"; // Replace with your API key
            const url = `https://api.imgbb.com/1/upload?key=${apiKey}`;

            const formData = new FormData();
            formData.append("image", file);

            try {
                const response = await fetch(url, {
                    method: "POST",
                    body: formData,
                });

                const result = await response.json();
                return result.data.url;
            } catch (error) {
                console.error("Upload failed:", error);
            }
        }

        let fileReader = new FileReader();

        fileReader.onload = function (e) {
            ThunkableWebviewerExtension.postMessage(JSON.stringify({
                type: 'readed',
                file: e.target.result
            }));
        }

        fileReader.onerror = function (e) {
            console.error(e)
            ThunkableWebviewerExtension.postMessage(JSON.stringify({
                type: 'error',
                error: e
            }));
        }

        ThunkableWebviewerExtension.receiveMessage(async function (message) {
            let json = JSON.parse(message);


            console.log(json.file)
            let blob = uploadImage(json.file);

            if (json.type == 'base64') {
                fileReader.readAsDataURL(blob);
            }
        });
    </script>





</body>

</html>