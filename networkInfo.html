<html lang="en">

<head>
    <meta charset="UTF-8">




    <title>CodePen - A Pen by lukeplays33</title>

    <link rel="canonical" href="https://codepen.io/lukeplays33/pen/JjQOmMb">








</head>
<style>
    body,
    html {
        margin: 0px;

        width: 100%;
        height: 100%;

        background-color: TRANSPARENT;
    }

    #focus {
        height: 0px;
        width: 0px;
        border-width: 0px;
        border-color: TRANSPARENT;

        background-color: TRANSPARENT;
        outline: none;
    }

    #focus:focus {
        border-width: 0px;
        border-color: TRANSPARENT;

        background-color: TRANSPARENT;

        outline: none;
    }
</style>

<body>
    <script src="https://thunkable.github.io/webviewer-extension/thunkableWebviewerExtension.js"
        type="text/javascript"></script>

    <script id="rendered-js" type="module">
        let userImageLink = "https://cdna.artstation.com/p/assets/images/images/012/488/936/large/marcin-bystrzycki-70.jpg?1535043998";
        let downloadSize = 564846 * 2; //bytes
        let time_start, end_time;

        let dandidate, connection;

        window.RTCPeerConnection = window.RTCPeerConnection || window.mozRTCPeerConnection || window.webkitRTCPeerConnection;
        let pc = new RTCPeerConnection({ iceServers: [] }), noop = function () { };
        pc.createDataChannel(""); // create a bogus data channel
        pc.createOffer(pc.setLocalDescription.bind(pc), noop); // create offer and set local description
        pc.onicecandidate = function (ice) {
            if (ice && ice.candidate && ice.candidate.candidate) {
                dandidate = ice.candidate;
                pc.onicecandidate = noop;
            }
        };

        async function MeasureConnectionSpeed() {
            return new Promise((resolve) => {
                let downloadImgSrc = new Image();

                downloadImgSrc.onload = function () {
                    end_time = new Date().getTime();

                    let timeDuration = (end_time - time_start) / 1000;
                    let loadedBits = downloadSize * 8;

                    /* Converts a number into string
                       using toFixed(2) rounding to 2 */
                    let bps = (loadedBits / timeDuration).toFixed(2);
                    let speedInKbps = (bps / 1024).toFixed(2);
                    let speedInMbps = (speedInKbps / 1024).toFixed(2);
                    alert("Your internet connection speed is: \n"
                        + bps + " bps\n" + speedInKbps
                        + " kbps\n" + speedInMbps + " Mbps\n");
                };
                time_start = new Date().getTime();
                downloadImgSrc.src = userImageLink;
            });
        }

        ThunkableWebviewerExtension.receiveMessage(async function (message) {
            MeasureConnectionSpeed()
            if ("connection" in navigator) {
                connection = navigator.connection;
                //console.log(await MeasureConnectionSpeed())

                connection.onchange = function () {
                    ThunkableWebviewerExtension.postMessage(JSON.stringify({
                        "type": 'change'
                    }));
                }

                window.ononline = function () {
                    ThunkableWebviewerExtension.postMessage(JSON.stringify({
                        "type": 'connectionChange'
                    }));
                }

                window.onofline = function () {
                    alert()
                    ThunkableWebviewerExtension.postMessage(JSON.stringify({
                        "type": 'connectionChange'
                    }));
                }

                ThunkableWebviewerExtension.postMessage(JSON.stringify({
                    "mDNS": dandidate.address,
                    "port": dandidate.port,
                    "protocol": dandidate.protocol,
                    "networkType": connection.effectiveType,
                    "downlinkSpeed": connection.downlink,
                    "RTT": connection.rtt,
                    "type": connection.type,
                    //"speed": await MeasureConnectionSpeed()
                }));
            }

        });
    </script>





</body>

</html>